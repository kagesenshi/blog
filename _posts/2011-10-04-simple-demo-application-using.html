---
author: kagesenshi
blogger_id: tag:blogger.com,1999:blog-28371165.post-6363733868306158659
blogger_orig_url: https://blog.kagesenshi.org/2011/10/simple-demo-application-using.html
categories:
- old blog
date: '2011-10-04T00:21:00.001+08:00'
layout: post
modified_time: '2011-10-07T12:39:58.122+08:00'
tags:
- Grok
- Python
- Hacks
- HOWTO
- PlanetPlone
- Plone
title: A simple demo application using collective.trajectory
---

<a href="http://blog.kagesenshi.org/2011/09/introducing-collectivetrajectory-url.html">Last week</a> I wrote about a Plone library called <a href="http://pypi.python.org/pypi/collective.trajectory">collective.trajectory</a> which allows you to do url routing on Plone content type. Back then it was only able to route the context, but I have yet to try develop something on it yet. <br /><br />A few days ago on <a href="http://geekcamp.my/">geekcamp.my</a>, I gave a talk on it, so naturally, I'll need to test to develop something on it first before doing the talk. Using trajectory, I hacked together a simple app, which fetch a profile page from Facebook, to demonstrate the library capabilities. Here's the howto.<br /><br /><b>Goals</b><br /><br />Create a content type which can be added on any part of site, where if user load a subpath of the content, it will load a profile info from graph.facebook.com, and serve it as a context in Plone.<br /><br /><b>Creating an archetype project</b><br /><br />First you'll need <a href="http://pypi.python.org/pypi/ZopeSkel">ZopeSkel</a> in your buildout. Add this section into buildout.cfg:<br /><br /><pre>[paster]<br />recipe = zc.recipe.egg<br />eggs = <br />   ZopeSkel<br />   PasteScript</pre><br />Execute <code>./bin/buildout install paster</code> afterwards. Once thats done, you should have paster command in your bin directory.<br /><br />Create an archetype product using ZopeSkel.<br /><br /><pre>./bin/paster create -t archetype <br />Selected and implied templates:<br />  ZopeSkel#basic_namespace  A basic Python project with a namespace package<br />  ZopeSkel#plone            A project for Plone products<br />  ZopeSkel#archetype        A Plone project that uses Archetypes content types<br />Enter project name: example.trajectory<br />.....</pre><br />That should create a directory called example.trajectory in the current directory. Now, lets create a simple archetype content.<br /><br /><pre>cd example.trajectory<br />../bin/paster addcontent contenttype<br />Enter contenttype_name (Content type name ) ['Example Type']: FacebookProfiles<br />Enter contenttype_description (Content type description ) ['Description of the Example Type']: An <br />application which fetch facebook profile from graph.facebook.com<br />Enter folderish (True/False: Content type is Folderish ) [False]: </pre><br />Notice that Folderish is False. We doesn't need the content to be folderish here.<br /><br /><b>Hooking the archetype product to Plone</b><br /><br />After creating the archetype product above, we'll need to hook it in Plone.<br /><br />In your buildout.cfg, add these:<br /><br /><pre>[buildout]<br />eggs = <br />    ...<br />    collective.trajectory<br />    example.trajectory<br />    ...<br /><br />zcml =<br />   ...<br />   collective.trajectory<br />   example.trajectory<br />   ...<br /><br />develop = <br />   ...<br />   ./example.trajectory<br />   ...</pre><br />Run ./bin/buildout and at this point, you should have the base we need for this demo app. If you start the Plone server you should see the product installable, and you can add the content after installing the product. Now for the fun stuff.<br /><br /><b>Registering trajectory traverser to contenttype</b><br /><br />Edit example.trajectory/example/trajectory/configure.zcml , and add this:<br /><br /><pre>&lt;adapter factory="collective.trajectory.components.Traverser"<br />    for="example.trajectory.content.facebookprofiles.FacebookProfiles<br />         zope.publisher.interfaces.IRequest"/&gt;</pre><br /><b>Registering routes and factories</b><br /><br />Edit example.trajectory/example/trajectory/content/facebookprofiles.py, and you can register the routes directly there.<br /><br /><pre>...<br />import traject<br />from collective.trajectory import getApp, Model<br />from zope.globalrequest import getRequest<br />import json, urllib<br />...<br />class FacebookProfiles(base.ATCTContent):<br />...<br /><br />class Profile(Model):<br />    def __init__(self, id, data):<br />        self.id = id<br />        self.data = data<br /><br />def factory(profile_id):<br />    data = urllib.urlopen('http://graph.facebook.com/%s' % profile_id).read()<br />    data = json.loads(data)<br />    return Profile(profile_id, data)<br /><br />def arguments(obj):<br />    return {<br />        'profile_id': obj.id<br />    }<br /><br />traject.register(FacebookProfiles, 'profile/:profile_id', factory)<br />traject.register_inverse(FacebookProfiles, Profile,<br />                    'profile/:profile_id', arguments)<br /></pre><br />Done, now when you access http://site/path/to/facebookprofilesapp/profile/somefacebookid, you should get a Profile object.<br /><br />Now we need to register a simple view for the profile<br /><br /><b>Registering a default view</b><br /><br />Create example.trajectory/example/trajectory/browser/facebookprofiles.py and fill it with this:<br /><br /><pre>from Products.Five import BrowserView<br /><br />class ProfileView(BrowserView):<br />    pass</pre><br />Edit example.trajectory/example/trajectory/browser/configure.zcml and add this:<br /><br /><pre>&lt;browser:page<br />      name="index"<br />      for="example.trajectory.content.facebookprofiles.Profile"<br />      template="profileview.pt"<br />      permission="zope2.View"<br />      class=".facebookprofiles.ProfileView"/&gt;</pre><br />Create example.trajectory/example/trajectory/browser/profileview.pt and fill it with this:<br /><br /><pre>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;<br />&lt;html xmlns="http://www.w3.org/1999/xhtml"<br />      xmlns:tal="http://xml.zope.org/namespaces/tal"<br />      xmlns:metal="http://xml.zope.org/namespaces/metal"<br />      metal:use-macro="context/main_template/macros/master"&gt;<br />&lt;head&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />  &lt;div metal:fill-slot="content"&gt;<br />      &lt;h1 tal:content="context/data/username"/&gt;<br />      &lt;dl&gt;<br />         &lt;dt&gt;Fullname&lt;/dt&gt;<br />         &lt;dd tal:content="context/data/name"&gt;&lt;/dd&gt;<br />         &lt;dt&gt;Facebook Page&lt;/dt&gt;<br />         &lt;dd&gt;&lt;a href="#" tal:attributes="href context/data/link" tal:content="here/data/link"&gt;&lt;/a&gt;&lt;/dd&gt;<br />      &lt;/dl&gt;<br />  &lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br />Thats it, if you add the FacebookProfiles content into your plone site, take for example http://site/myfolder/fbprofiles , when you load http://site/myfolder/fbprofiles/profile/yourfacebookid you should get a page with user 'yourfacebookid' details<br /><br />I've uploaded the example.trajectory demo into <a href="https://svn.plone.org/svn/collective/example.trajectory/trunk/">https://svn.plone.org/svn/collective/example.trajectory/trunk/</a> so that you can try it and refer to it.<br /><br />Happy hacking!<div class="blogger-post-footer"><br/>
<br/>
- Izhar Firdaus -</div>