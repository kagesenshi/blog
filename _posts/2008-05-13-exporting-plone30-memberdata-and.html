---
author: kagesenshi
blogger_id: tag:blogger.com,1999:blog-28371165.post-2120583291080382797
blogger_orig_url: https://blog.kagesenshi.org/2008/05/exporting-plone30-memberdata-and.html
categories:
- old blog
date: '2008-05-13T03:19:00.006+08:00'
layout: post
modified_time: '2011-10-07T12:39:58.088+08:00'
tags:
- python
- hacks
- plone
- zope
title: Exporting Plone3.0 Memberdata and Passwords
---

I need to export plone accounts from Inigo Intranet to LDAP. To accomplish that, first I need some way to export the data I need. Plone itself does not have such tool for it (that I know of).<br /><br />Not so long ago, <a href="http://kaeru.inigo-tech.com/">Kaeru</a> pointed me to <a href="http://www.zopelabs.com/cookbook/1140753093">a zope script for such purpose</a>, however, the script fails to extract passwords from Plone3.0 mainly due to passwords are now managed by the PluggableAuthService - which made getPassword() to return None and _getPassword() to raise NotImplementedError. I don't know whether somebody forgot to implement those functions into PAS or it was purposely done. Googling lead me to <a href="http://plone.org/documentation/how-to/export-member-data-to-csv">this page in plone.org</a> and from there, to this <a href="http://transcyberia.info/archives/23-howto-sync-mailman-from-plone.html">other script</a>. Again, none of them able to extract the password hashes. I lost hope with google, and to the source I went.<br /><br />After a whole night digging through the plone source, at last, I managed to found the method to extract the hash. So, heres the External Script which I wrote to extract stuff I want.<br /><br /><pre><br /># Memberdata export script for Plone 3.0<br />#<br /># based on:<br />#    http://transcyberia.info/archives/23-howto-sync-mailman-from-plone.html<br />#    http://www.zopelabs.com/cookbook/1140753093<br />#    http://plone.org/documentation/how-to/export-member-data-to-csv<br />#<br /># desc:<br />#    None of the scripts above can extract password hashes on Plone3.0, <br />#    BUT THIS ONE CAN!!!<br />#<br />#    Execute this as normal External Script, and DON'T make it public accessible <br />#    (unless you don't mind people having your hashes). You have been warned. <br />#    Have fun (^,^)<br />#<br /><br /><br />from StringIO import StringIO<br />import csv<br />import time<br /><br />def getMembersCSV(self):<br /><br />    request = self.REQUEST<br />    text = StringIO()<br />    writer = csv.writer(text)<br /><br />    # core properties (username/password)<br />    core_properties = ['member_id','password']<br /><br />    # extra portal_memberdata properties<br />    extra_properties = ['fullname',<br />                        'email',<br />                        'location',<br />                        'home_page',<br />                        'description']<br /><br />    properties = core_properties + extra_properties<br /><br />    writer.writerow(properties)<br /><br />    membership=self.portal_membership<br />    passwdlist=self.acl_users.source_users._user_passwords<br /><br />    for memberId in membership.listMemberIds():<br />        row = []<br />        for property in properties:<br />            if property == 'member_id':<br />               row.append(memberId)<br />            elif property == 'password':<br />               row.append(passwdlist[memberId])<br />            else:<br />               member = membership.getMemberById(memberId)<br />               row.append(member.getProperty(property))<br /><br />        writer.writerow(row)<br /><br /><br />    request.RESPONSE.setHeader('Content-Type','application/csv')<br />    request.RESPONSE.setHeader('Content-Length',len(text.getvalue()))<br />    request.RESPONSE.setHeader('Content-Disposition',<br />                               'inline;filename=members-%s.csv' %<br />                               time.strftime("%Y%m%d-%H%M%S",time.localtime()))<br /><br />    return text.getvalue()<br /></pre><br /><br />Have fun (^.^)<div class="blogger-post-footer"><br/>
<br/>
- Izhar Firdaus -</div>