---
layout: post
title: Virtual hosting on Grok (or Bluebream) - without a reverse proxy
date: '2012-07-26T16:42:00.001+08:00'
author: izhar firdaus
tags:
- Grok
- PlanetFedora
- HOWTO
- PlanetPlone
- Plone
- Zope
modified_time: '2012-07-26T16:44:05.399+08:00'
blogger_id: tag:blogger.com,1999:blog-28371165.post-4508697796712561320
blogger_orig_url: https://blog.kagesenshi.org/2012/07/virtual-hosting-on-grok-or-bluebream.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">When I was poking at creating the <a href="http://blog.kagesenshi.org/2012/07/grok-framework-quickstart-template-for.html">Grok template for OpenShift</a>, I needed to add virtual hosting for the test application.<br /><br />However, OpenShift's DIY cartridge does not allow me to modify the reverse proxy settings as they are automatically generated by the cartridge. Naturally, I had to find another way. <br /><br /><b>Grok virtual hosting with WSGIRewrite</b><br /><br />WSGIRewrite is a WSGI middleware which provide a facility for mod_rewrite compatible rewrite rules for WSGI applications. Using this middleware, we can rewrite the URL to force virtual hosting on the application server.<br /><br />Lets go straight to the meat, here is the howto.<br /><br /><b>Howto</b> <br /><br />The first step is of course, to add WSGIRewrite into your buildout. Edit setup.py and add 'WSGIRewrite' into the install_requires list, and re-run buildout.<br /><br />Afterward, edit your WSGI INI file, (eg: etc/deploy.ini.in), and find a section called <tt>pipeline:main</tt>, and add <tt>rewrite</tt> as the first item in the pipeline. The section should appear like this now:<br /><br /><pre>[pipeline:main]<br />pipeline = rewrite accesslogging evalexception fanstatic grok</pre><br />At the bottom of the file, add these lines. Replace <tt>examplesite</tt>with an identifier for the entry, replace <tt>app</tt> with your application ID, and replace <tt>www.example.com</tt> with the virtual hosting domain: <br /><br /><pre>[filter:rewrite]<br />use = egg:WSGIRewrite<br />rulesets = examplesite-http examplesite-https<br /><br />[wsgirewrite:examplesite-http]<br />cond1 = %{HTTP_HOST} ^www.example.com$<br />cond2 = %{HTTPS} off<br />rule1 = ^/(.*) app/++vh++http:www.example.com/++/$1<br /><br />[wsgirewrite:examplesite-https]<br />cond1 = %{HTTP_HOST} ^www.example.com$<br />cond2 = %{HTTPS} on<br />rule1 = ^/(.*) app/++vh++https:www.example.com/++/$1</pre><pre>&nbsp;</pre><div style="text-align: left;">Rerun buildout to regenerate your INI files, and start your paster/wsgi server. Access the server using the configured domain, and it should work.</div></div><div class="blogger-post-footer"><br/>
<br/>
- Izhar Firdaus -</div>