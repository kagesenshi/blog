---
author: kagesenshi
blogger_id: tag:blogger.com,1999:blog-28371165.post-9164315093597362569
blogger_orig_url: https://blog.kagesenshi.org/2009/09/grokking-grok-ii.html
categories:
- old blog
date: '2009-09-14T16:21:00.004+08:00'
layout: post
modified_time: '2011-10-07T12:39:58.149+08:00'
tags:
- grok
- python
- plone
- zope
thumbnail: http://1.bp.blogspot.com/_0DENAyCRujw/Sq36bDqB76I/AAAAAAAAAkw/baxHLGmWhY4/s72-c/2009091401.png
title: Grokking Grok - II
---

Grok, like Plone uses the Zope way of storing data - <code>Persistence</code>, somewhat like 'pickling' in Python. <br /><br />All instance of objects are treated not as tables like in frameworks such as <a href="http://www.turbogears.org/">TurboGears</a>, but as normal runtime class instance objects. There are no need to think of SQL, neither designing a database. Just dump the objects into the ZODB. <br /><br /><b>Base Model Stereotype</b><br /><br />The are 3 main model stereotype in Grok,  <code>grok.Model</code> , <code>grok.Container</code> , <code>grok.Application</code><br /><br /><b><i>grok.Model</i></b><br /><br />This is the stereotype for a persistence class. Classes that inherits this stereotype are addable and can store persistent data. <br /><br /><b><i>grok.Container</i></b><br /><br />This stereotype give a class a folder-like ability to store children. Inherit from this class if you want to create objects which can store another object.<br /><br /><b><i>grok.Application</i></b><br /><br />This is the stereotype of a persistence class which can be added at the root of the Zope3 site. <br /><br /><b>Layout</b><br /><br />Siteroot may contain Applications, Applications may contain both Containers and Models, Containers may contain both Containers and Models.<br /><br /><b>Defining a simple Grok Model</b><br /><br />Assumes you've created a project called MyProject. Edit <code>$buildout/src/myproject/app.py</code>. You should see something like this<br /><br /><pre>import grok<br /><br />class MyProject(grok.Application, grok.Container):<br />   pass<br /><br />class Index(grok.View):<br />   pass</pre><br /><br />Lets create a simple <code>grok.Container</code> model which called <code>MyFolder</code> and a normal model called <code>MyDocument</code>. Add these into <code>app.py</code><br /><br /><pre>class MyFolder(grok.Container,grok.Model):<br />   pass<br /><br />class MyDocument(grok.Model):<br />   pass<br /></pre><br /><br />Done.<br /><br /><b>Writing a simple AddForm for adding objects</b><br /><br />Grok provides some handy classes for automatically generating forms which based on <code>zope.forms</code>. So you can quickly generate a form using it. Lets create a form to add MyFolder into MyProject.<br /><br />First, as we are going to have multiple Zope Views (forms are considered as views) in this app.py, Index class need to be modified a bit.<br /><br /><pre>class Index(grok.View):<br />   grok.context(MyProject)</pre><br /><br />By default, The context will be acquired from the only Model available in the .py file. But as this example have multiple models in the .py file, that need to be defined.<br /><br />Next, define the fields which we want MyFolder to have (note: put this code above MyFolder class definition).<br /><br /><pre>from zope.interface import Interface<br />from zope import schema<br /><br />class IMyFolder(Interface):<br />   name = schema.TextLine(title=u'Object Name')<br />   title = schema.TextLine(title=u'Title')</pre><br /><br />As you can see, instead of adding the attributes into the MyFolder class, we created an Interface. Next, make MyFolder implement the Interface<br /><br /><pre>class MyFolder(grok.Container,grok.Model):<br />   grok.implements(IMyFolder)</pre><br /><br />Afterward, lets create a form<br /><br /><pre>class MyFolderAddForm(grok.AddForm):<br />   grok.context(MyProject)<br /><br />   form_fields = grok.AutoFields(IMyFolder)<br /><br />   @grok.action(u'Add MyFolder')<br />   def add(self,**data):<br />       mf = MyFolder()<br />       self.applyData(mf,**data)<br />       name = data['name']<br />       self.context[name] = mf<br />       self.redirect(self.url(mf))</pre><br /><br />Done. Up to this point, you now have an application called MyProject, and an addable model called MyFolder. Now to adjust the templates.<br /><br />Edit <code>$buildout/src/myproject/app_templates/index.pt</code> and replace the template with this:<br /><br /><pre><br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;h1&gt;Welcome to My Application&lt;/h1&gt;<br />&lt;a href="myfolderaddform"&gt;Add MyFolder&lt;/a&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br /><br /><b>Creating a View for a Model</b><br /><br />MyFolder at the moment does not have a default view template. So lets create one. Create a View by adding this:<br /><br /><pre>class MyFolderView(grok.View): <br />   grok.context(MyFolder)<br />   grok.name('index')</pre><br /><br />Then edit <code>$buildout/src/myproject/app_templates/myfolderview.pt</code>, and put this as the template:<br /><br /><pre>&lt;html&gt;<br />&lt;head&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />  This is a new MyFolder object called &lt;tal:name replace="context/name"/&gt;<br />    with title '&lt;tal:name replace="context/title"/&gt;'<br />&lt;/body&gt;<br />&lt;/html&gt;</pre><br /><br />Done. You should now be able to add an application called MyProject, and add a MyFolder in it.<br /><br /><b>Running you application</b><br /><br />Start Zope3<br /><br /><pre>$buildout/bin/zopectl fg</pre><br /><br />Open http://localhost:8080/. <br /><br /><a style="text-align:center" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_0DENAyCRujw/Sq36bDqB76I/AAAAAAAAAkw/baxHLGmWhY4/s1600-h/2009091401.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 217px;" src="http://1.bp.blogspot.com/_0DENAyCRujw/Sq36bDqB76I/AAAAAAAAAkw/baxHLGmWhY4/s320/2009091401.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5381232472522616738" /></a><br /><br /><br />Add a MyProject, name it as testapp and open it. <br /><br /><a style="text-align:center" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_0DENAyCRujw/Sq36alUymvI/AAAAAAAAAko/FjOhnU1bNhA/s1600-h/2009091402.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 70px;" src="http://4.bp.blogspot.com/_0DENAyCRujw/Sq36alUymvI/AAAAAAAAAko/FjOhnU1bNhA/s320/2009091402.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5381232464380467954" /></a><br /><br />Click the "Add MyFolder" link. <br /><br /><a style="text-align:center" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_0DENAyCRujw/Sq36Z0MBpWI/AAAAAAAAAkg/h4Vvx4TkBmY/s1600-h/2009091403.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 116px;" src="http://4.bp.blogspot.com/_0DENAyCRujw/Sq36Z0MBpWI/AAAAAAAAAkg/h4Vvx4TkBmY/s320/2009091403.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5381232451190367586" /></a><br /><br /><br />Add a new MyFolder object, name it as testfolder, afterward you should see this<br /><br /><a style="text-align:center" onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_0DENAyCRujw/Sq36ZWGvkQI/AAAAAAAAAkY/1TCiOvF_aJU/s1600-h/2009091404.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 320px; height: 30px;" src="http://4.bp.blogspot.com/_0DENAyCRujw/Sq36ZWGvkQI/AAAAAAAAAkY/1TCiOvF_aJU/s320/2009091404.png" border="0" alt=""id="BLOGGER_PHOTO_ID_5381232443115147522" /></a><br /><br />Thats it for now. Try to add an AddForm for MyDocument by yourself.<br /><br /><b>More details?</b><br /><br />Read the official tutorial here : <a href="http://grok.zope.org/doc/current/tutorial.html">http://grok.zope.org/doc/current/tutorial.html</a><br /><br />Zope TAL Spec : <a href="http://wiki.zope.org/ZPT/TALSpecification14">http://wiki.zope.org/ZPT/TALSpecification14</a><br /><br />Zope Component Architecture : <a href="http://www.muthukadan.net/docs/zca.html">http://www.muthukadan.net/docs/zca.html</a><br /><br />Grok/Zope Forms : <a href="http://grok.zope.org/documentation/phc_topic_area?topic=Forms">http://grok.zope.org/documentation/phc_topic_area?topic=Forms</a><br /><br />Have fun<div class="blogger-post-footer"><br/>
<br/>
- Izhar Firdaus -</div>