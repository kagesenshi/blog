---
layout: post
title: Integrating hurry.resource into BFG
date: '2010-06-19T09:05:00.004+08:00'
author: izhar firdaus
tags:
- Python
- Hacks
- HOWTO
- repoze.bfg
- Zope
modified_time: '2010-06-19T10:01:21.849+08:00'
blogger_id: tag:blogger.com,1999:blog-28371165.post-9004808249593980482
blogger_orig_url: https://blog.kagesenshi.org/2010/06/integrating-hurryresource-into-bfg.html
---

Back in PyCon APAC last week I was introduced to <a href="http://pypi.python.org/pypi/hurry.resource/">hurry.resource</a> by its author, which is also one of the founder behind <a href="http://grok.org">Grok</a>, <a href="http://www.startifact.com/">Martijn Faassen.</a><br /><br /><b>So, what does it do?.</b><br /><br /><a href="http://pypi.python.org/pypi/hurry.resource/">Read Here</a><br /><br />Lets go to the fun part<br /><br /><b> Setting Up</b><br /><br />Assuming you are using one of the default <a href="http://bfg.repoze.org">BFG</a> templates<br /><br />First, <a href="http://docs.repoze.org/bfg/current/narr/zca.html#enabling-the-zca-global-api-by-using-hook-zca">enable ZCA</a>. (or just do this in <code>run.py</code>):<br /><pre>...<br />    config = Configurator(root_factory=get_root, settings=settings)<br />    config.hook_zca()<br />    config.begin()<br />...</pre><br /><br />Do this little modification on the <code>get_root</code> function in model.py:<br /><pre>from repoze.bfg.interfaces import IRequest<br /><br />def get_root(request):<br />    request.registry.registerUtility(request,provided=IRequest)<br />    return root</pre><br /><br />Add some component codes, name the file <code>resource.py</code><br /><pre>from hurry.resource.interfaces import ICurrentNeededInclusions<br />from hurry.resource.interfaces import ILibraryUrl<br />from zope.interface import implements,implementer<br />from zope.component import getUtility,adapter<br />from hurry.resource import NeededInclusions<br />from repoze.bfg.interfaces import IRequest<br />from hurry.resource.core import Library<br /><br />class NeededInclusion(object):<br />   implements(ICurrentNeededInclusions)<br /><br />   def __call__(self):<br />       request = getUtility(IRequest)<br />       if not hasattr(request,'needed'):<br />          request.needed = NeededInclusions()<br />       return request.needed<br /><br />@implementer(ILibraryUrl)<br />@adapter(Library)<br />def LibraryUrl(library):<br />    request = getUtility(IRequest)<br />    return "%s/hurry/%s" % (request.application_url,library.name)</pre><br /><br />and hook them into ZCA by adding these into <code>configure.zcml</code><br /><pre>&lt;utility factory=".resource.NeededInclusion"/&gt;<br />  &lt;adapter factory=".resource.LibraryUrl"/&gt;</pre><br /><br /><b>Adding into template</b><br />In your main template head section, add:<pre>&lt;tal:cond condition="getattr(request,'needed',None)"&gt;<br />   &lt;tal:res replace="structure request.needed.render()"/&gt;<br />&lt;/tal:cond&gt;</pre><br /><br /><b>Using it</b><br /><br />Lets take <a href="http://pypi.python.org/pypi/hurry.jquery">hurry.jquery</a> for example:<br /><br />First, register the static files, add these into <code>configure.zcml</code><br /><pre>&lt;static<br />     name="hurry/jquery"<br />     path="hurry.jquery:jquery-build"<br />     /&gt;</pre><br /><br />If you want to include Jquery js into your current view, just do this in the view code:<br /><pre>from hurry.jquery import jquery<br />def my_view(request):<br />    jquery.need()<br />    return {'project':'helloworld'}</pre><br /><br />If you did the stuff above correctly, with luck , your view should have this in place of the <code>tal</code> block.<br /><br /><pre>&lt;script type="text/javascript" <br />     src="http://localhost:6543/hurry/jquery/jquery-1.4.2.js"&gt;&lt;/script&gt;</pre><br /><br /><b>Custom Resource Libraries</b><br /><br />You can create your own custom resource libraries and share/reuse it. To create your own resource, read the <a href="http://pypi.python.org/pypi/hurry.resource/">documentation of hurry.resource</a><br /><br />Considering hurry.resource is also used in Grok and probably several other ZCA based frameworks, your resource library can also be reused on these frameworks with little to no modifications.<br /><br />Credits to Martijn for this awesome component.<br /><br />Happy hacking :D<div class="blogger-post-footer"><br/>
<br/>
- Izhar Firdaus -</div>